# nmap扫描

## 流程

首先要保存扫描的文件

```
mkdir nmapscan
```



其次，第一次扫描，可以只简单扫描目标主机开放的TCP端口信息

```
nmap -sT -p- --min-rate 10000 <ip> -oA ./nmapscan/ports
```





可以定义一个变量用来接收端口信息

```
port=$(cat ./nmapscan/ports.nmap | grep open | awk -F'/' '{print $1}'| paste -sd,)
```

即读取第一次扫描的结果，提取出开放的端口，并以 " ，\" 作为分隔符，为后续扫描作准备





第二次扫描为最重要的一次扫描，扫描目标主机的操作系统信息，服务版本信息

```
nmap -sCV -O -p <ports> <ip> -oA ./nmapscan/detail
```





第三次扫描为UDP扫描，扫描常用的20个端口即可

```
nmap -sU --top-ports 20 <ip> -oA ./nmapscan/udp
```





第四次扫描为漏洞脚本扫描，利用脚本探测目标主机可能存在的漏洞信息

```
nmap --script=vuln -p <ports> <ip> -oA nmapscan/vuln
```



虽然UDP扫描和脚本扫描一般不会有很大价值的发现，但是每次都值得尝试



## 关于参数使用场景

-sT TCP连接扫描：

- 默认的TCP扫描方式，通过完成TCP三次握手确认端口状态。
- 适用于大多数情况，但容易被目标系统检测到。

-sU UDP扫描：

- 用于扫描UDP端口（如DNS、SNMP、NTP）。
- UDP扫描速度较慢，建议只扫描常用端口。

--min-rate 10000 最小发包速率：

- 控制Nmap的扫描速度，避免触发目标系统的防御机制。
- 适用于需要快速扫描的场景。

-p- 全端口扫描：

- 扫描目标主机的所有65535个端口。
- 适用于需要全面了解目标主机开放端口的场景。

-sn ping扫描：

- 仅进行主机发现，不扫描端口。
- 适用于快速确认目标主机是否存活。

-sC 默认脚本扫描：

- 使用Nmap的默认脚本集进行扫描。
- 适用于快速识别目标主机的常见漏洞和配置错误。

-sV 服务版本检测：

- 检测目标主机上运行的服务版本信息。
- 适用于需要详细了解目标主机服务版本的场景。

-O 操作系统检测：

- 检测目标主机的操作系统类型和版本。
- 适用于需要详细了解目标主机操作系统的场景。

--top-ports 20 常用端口扫描：

- 扫描目标主机的20个最常用端口。
- 适用于快速扫描目标主机的常见服务。

-T4 加快扫描速度：

- 加快Nmap的扫描速度，适用于时间紧迫的场景。
- `-T5`速度更快，但可能会丢失数据包。

-Pn 跳过主机发现：

- 跳过主机发现阶段，直接扫描端口。
- 适用于已知目标主机存活的场景。

--open 只显示开放端口：

- 只显示开放端口，减少输出噪音。
- 适用于需要快速了解目标主机开放端口的场景。